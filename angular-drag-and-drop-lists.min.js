/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(n){function e(n,e){return"all"==e?n:n.filter(function(n){return-1!=e.toLowerCase().indexOf(n)})}var t="application/x-dnd",r="application/json",a="Text",d=["move","copy","link"]
n.directive("dndDraggable",["$parse","$timeout",function(n,i){return function(l,f,c){f.attr("draggable","true"),c.dndDisableIf&&l.$watch(c.dndDisableIf,function(n){f.attr("draggable",!n)}),f.on("dragstart",function(s){if(s=s.originalEvent||s,"false"==f.attr("draggable"))return!0
o.isDragging=!0,o.itemType=c.dndType&&l.$eval(c.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=c.dndEffectAllowed||d[0],s.dataTransfer.effectAllowed=o.effectAllowed
var g=l.$eval(c.dndDraggable),u=t+(o.itemType?"-"+o.itemType:"")
try{s.dataTransfer.setData(u,angular.toJson(g))}catch(n){var p=angular.toJson({item:g,type:o.itemType})
try{s.dataTransfer.setData(r,p)}catch(n){var v=e(d,o.effectAllowed)
s.dataTransfer.effectAllowed=v[0],s.dataTransfer.setData(a,p)}}if(f.addClass("dndDragging"),i(function(){f.addClass("dndDraggingSource")},0),s._dndHandle&&s.dataTransfer.setDragImage&&s.dataTransfer.setDragImage(f[0],0,0),n(c.dndDragstart)(l,{event:s}),c.dndCallback){var y=n(c.dndCallback)
o.callback=function(n){return y(l,n||{})}}s.stopPropagation()}),f.on("dragend",function(e){e=e.originalEvent||e,l.$apply(function(){var t=o.dropEffect
n(c[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[t]])(l,{event:e}),n(c.dndDragend)(l,{event:e,dropEffect:t})}),o.isDragging=!1,o.callback=void 0,f.removeClass("dndDragging"),f.removeClass("dndDraggingSource"),e.stopPropagation(),i(function(){f.removeClass("dndDraggingSource")},0)}),f.on("click",function(e){c.dndSelected&&(e=e.originalEvent||e,l.$apply(function(){n(c.dndSelected)(l,{event:e})}),e.stopPropagation())}),f.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),n.directive("dndList",["$parse",function(n){return function(i,l,f){function c(n){if(!n)return a
for(var e=0;e<n.length;e++)if(n[e]==a||n[e]==r||n[e].substr(0,t.length)==t)return n[e]
return null}function s(n){return o.isDragging?o.itemType||void 0:n==a||n==r?null:n&&n.substr(t.length+1)||void 0}function g(n){return!m.disabled&&(!(!m.externalSources&&!o.isDragging)&&(!m.allowedTypes||null===n||n&&-1!=m.allowedTypes.indexOf(n)))}function u(n,t){var r=d
return t||(r=e(r,n.dataTransfer.effectAllowed)),o.isDragging&&(r=e(r,o.effectAllowed)),f.dndEffectAllowed&&(r=e(r,f.dndEffectAllowed)),r.length?n.ctrlKey&&-1!=r.indexOf("copy")?"copy":n.altKey&&-1!=r.indexOf("link")?"link":r[0]:"none"}function p(){return D.remove(),l.removeClass("dndDragover"),!0}function v(e,t,r,a,d,l){return n(e)(i,{callback:o.callback,dropEffect:r,event:t,external:!o.isDragging,index:void 0!==d?d:y(),item:l||void 0,type:a})}function y(){return Array.prototype.indexOf.call(h.children,T)}var D=function(){var n
return angular.forEach(l.children(),function(e){var t=angular.element(e)
t.hasClass("dndPlaceholder")&&(n=t)}),n||angular.element("<li class='dndPlaceholder'></li>")}()
D.remove()
var T=D[0],h=l[0],m={}
l.on("dragenter",function(n){n=n.originalEvent||n
var e=f.dndAllowedTypes&&i.$eval(f.dndAllowedTypes)
m={allowedTypes:angular.isArray(e)&&e.join("|").toLowerCase().split("|"),disabled:f.dndDisableIf&&i.$eval(f.dndDisableIf),externalSources:f.dndExternalSources&&i.$eval(f.dndExternalSources),horizontal:f.dndHorizontalList&&i.$eval(f.dndHorizontalList)}
var t=c(n.dataTransfer.types)
if(!t||!g(s(t)))return!0
n.preventDefault()}),l.on("dragover",function(n){n=n.originalEvent||n
var e=c(n.dataTransfer.types),t=s(e)
if(!e||!g(t))return!0
if(T.parentNode!=h&&l.append(D),n.target!=h){for(var r=n.target;r.parentNode!=h&&r.parentNode;)r=r.parentNode
if(r.parentNode==h&&r!=T){var d=r.getBoundingClientRect()
if(m.horizontal)var o=n.clientX<d.left+d.width/2
else var o=n.clientY<d.top+d.height/2
h.insertBefore(T,o?r:r.nextSibling)}}var i=e==a,y=u(n,i)
return"none"==y?p():f.dndDragover&&!v(f.dndDragover,n,y,t)?p():(n.preventDefault(),i||(n.dataTransfer.dropEffect=y),l.addClass("dndDragover"),n.stopPropagation(),!1)}),l.on("drop",function(n){n=n.originalEvent||n
var e=c(n.dataTransfer.types),t=s(e)
if(!e||!g(t))return!0
n.preventDefault()
try{var d=JSON.parse(n.dataTransfer.getData(e))}catch(n){return p()}if((e==a||e==r)&&(t=d.type||void 0,d=d.item,!g(t)))return p()
var l=e==a,D=u(n,l)
if("none"==D)return p()
var T=y()
if(f.dndDrop){if(!(d=v(f.dndDrop,n,D,t,T,d)))return p()
if(o.dropEffect=D,l||(n.dataTransfer.dropEffect=D),("object"==typeof d||"function"==typeof d)&&"function"==typeof d.then)return d.then(function(e){return e?(!0!==e&&i.$apply(function(){i.$eval(f.dndList).splice(T,0,e)}),v(f.dndInserted,n,D,t,T,e),p()):p()}).catch(function(){return p()}),n.stopPropagation(),!1}return o.dropEffect=D,l||(n.dataTransfer.dropEffect=D),!0!==d&&i.$apply(function(){i.$eval(f.dndList).splice(T,0,d)}),v(f.dndInserted,n,D,t,T,d),p(),n.stopPropagation(),!1}),l.on("dragleave",function(n){n=n.originalEvent||n
var e=document.elementFromPoint(n.clientX,n.clientY)
h.contains(e)&&!n._dndPhShown?n._dndPhShown=!0:p()})}}]),n.directive("dndNodrag",function(){return function(n,e,t){e.attr("draggable","true"),e.on("dragstart",function(n){n=n.originalEvent||n,n._dndHandle||(n.dataTransfer.types&&n.dataTransfer.types.length||n.preventDefault(),n.stopPropagation())}),e.on("dragend",function(n){n=n.originalEvent||n,n._dndHandle||n.stopPropagation()})}}),n.directive("dndHandle",function(){return function(n,e,t){e.attr("draggable","true"),e.on("dragstart dragend",function(n){n=n.originalEvent||n,n._dndHandle=!0})}})
var o={}}(angular.module("dndLists",[]))
